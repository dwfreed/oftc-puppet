# File managed by puppet

test: /tmp/ip4.old /tmp/ip6.old
	ferm -nl --shell ferm.conf > /tmp/ferm.out
	@if [ -f /tmp/ip4.new ]; then mv /tmp/ip4.new /tmp/ip4.old; fi
	@if [ -f /tmp/ip6.new ]; then mv /tmp/ip6.new /tmp/ip6.old; fi
	@sed -ne '/^# Generated by ferm/d' -e '/iptables-restore/,/EOT/p' /tmp/ferm.out > /tmp/ip4.new
	@sed -ne '/^# Generated by ferm/d' -e '/ip6tables-restore/,/EOT/p' /tmp/ferm.out > /tmp/ip6.new
	diff -u /tmp/ip4.old /tmp/ip4.new || :
	diff -u /tmp/ip6.old /tmp/ip6.new || :

%.old:
	touch $@

clean:
	rm -f /tmp/*.out /tmp/*.old /tmp/*.new
